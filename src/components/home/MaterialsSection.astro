---
import { homepageData } from "../../data/homepage";
import { withBase } from "../../utils/withBase";
import ButtonLink from "../ui/ButtonLink.astro";
import SectionHeading from "../ui/SectionHeading.astro";

interface Props {
  materials: typeof homepageData.materials;
}

const { materials } = Astro.props;
const materialItems = materials.items.map((item) => ({ ...item, image: withBase(item.image) }));
---

<section
  id="materials"
  class="section-shell bg-bg-soft/60"
  data-materials-root
>
  <div class="container-page">
    <div data-motion-reveal>
      <SectionHeading title={materials.title} description={materials.intro} />
    </div>

    <div class="mt-8" data-motion-reveal style="--reveal-delay:90ms">
      <div class="relative hidden min-h-[46rem] lg:block" data-material-stack-desktop>
        {materialItems.map((item, index) => (
          <article
            class="material-stack-card material-stack-card--desktop focus-ring absolute w-full max-w-[94%] overflow-hidden rounded-lg border border-transparent text-left shadow-soft transition"
            data-material-card
            data-index={String(index)}
            tabindex="0"
            style={`top:${index * 52}px; left:${index * 14}px; --stack-z:${materialItems.length - index}; background-image: linear-gradient(150deg, rgba(30,29,26,.03), rgba(30,29,26,.18)), url('${item.image}'); background-size:auto, cover; background-position:center; background-repeat:no-repeat;`}
          >
            <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/30 via-black/8 to-transparent"></div>
            <div class="material-info-glass absolute inset-x-4 bottom-4 p-4">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <p class="editorial-caption">{String(index + 1).padStart(2, "0")} / Vzorek</p>
                  <h3 class="mt-2 text-lg font-semibold leading-6 text-text">{item.name}</h3>
                  <p class="mt-2 text-sm leading-6 text-text-muted">{item.description}</p>
                </div>
              </div>
              <div class="mt-4 flex flex-wrap gap-2">
                {item.tags.map((tag) => (
                  <span class="rounded-full bg-highlight/95 px-3 py-1 text-xs font-medium text-text">
                    {tag}
                  </span>
                ))}
              </div>
              <p class="mt-4 text-sm leading-6 text-text">{item.suitableFor}</p>
              <div class="mt-4 rounded-md border hairline bg-surface/70 px-3 py-2 text-xs text-text-muted">
                Tón / reference: <span class="font-medium text-text">{item.tone}</span>
              </div>
            </div>
          </article>
        ))}
      </div>

      <div class="grid gap-4 lg:hidden" data-material-stack-mobile>
        {materialItems.map((item, index) => (
          <article
            class="surface-panel relative min-h-[27rem] overflow-hidden"
            style={`background-image: linear-gradient(150deg, rgba(30,29,26,.03), rgba(30,29,26,.2)), url('${item.image}'); background-size:auto, cover; background-position:center; background-repeat:no-repeat;`}
          >
            <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/32 via-black/10 to-transparent"></div>
            <div class="material-info-glass absolute inset-x-3 bottom-3 flex flex-col p-4">
              <p class="editorial-caption">{String(index + 1).padStart(2, "0")} / Vzorek</p>
              <h3 class="mt-3 text-lg font-semibold leading-6 text-text">{item.name}</h3>
              <p class="mt-2 text-sm leading-6 text-text-muted">{item.description}</p>
              <p class="mt-4 text-sm leading-6 text-text">
                <span class="font-medium">Vhodné pro:</span> {item.suitableFor}
              </p>
              <div class="mt-4 flex flex-wrap gap-2">
                {item.tags.map((tag) => (
                  <span class="rounded-full bg-highlight/95 px-3 py-1 text-xs font-medium text-text">
                    {tag}
                  </span>
                ))}
              </div>
              <div class="mt-auto pt-5">
                <div class="rounded-md border hairline bg-surface/70 px-3 py-2 text-xs text-text-muted">
                  Tón / reference: <span class="font-medium text-text">{item.tone}</span>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <div class="mt-8" data-motion-reveal style="--reveal-delay:160ms">
      <ButtonLink href={materials.cta.href} label={materials.cta.label} variant="secondary" />
    </div>
  </div>
</section>

<style>
  .material-stack-card--desktop {
    z-index: var(--stack-z, 1);
    transform: translateY(0) scale(0.985);
    min-height: 30rem;
    border-color: rgba(110, 106, 99, 0.14);
    transition:
      transform var(--motion-hover, 260ms) var(--motion-ease, cubic-bezier(0.22, 0.61, 0.36, 1)),
      box-shadow var(--motion-hover, 260ms) var(--motion-ease, cubic-bezier(0.22, 0.61, 0.36, 1)),
      border-color var(--motion-hover, 260ms) var(--motion-ease, cubic-bezier(0.22, 0.61, 0.36, 1));
  }

  .material-stack-card--desktop:hover,
  .material-stack-card--desktop:focus-visible {
    transform: translateY(-6px) scale(1);
    border-color: rgba(183, 140, 90, 0.35);
    box-shadow: var(--shadow-card);
  }

  .material-stack-card--desktop:hover {
    opacity: 1;
  }

  .material-stack-card--desktop:hover,
  .material-stack-card--desktop:focus-visible {
    z-index: 60;
  }

  .material-info-glass {
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.42);
    background:
      linear-gradient(140deg, rgba(255, 255, 255, 0.54), rgba(255, 255, 255, 0.3)),
      linear-gradient(180deg, rgba(247, 244, 238, 0.78), rgba(247, 244, 238, 0.62));
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.45),
      0 18px 32px rgba(30, 29, 26, 0.22);
    backdrop-filter: blur(10px) saturate(118%);
    -webkit-backdrop-filter: blur(10px) saturate(118%);
  }
</style>
