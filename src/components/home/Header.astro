---
import { homepageData } from "../../data/homepage";
import ButtonLink from "../ui/ButtonLink.astro";

interface Props {
  nav: typeof homepageData.nav;
}

const { nav } = Astro.props;
---

<header
  data-site-header
  class="sticky top-0 z-40 border-b border-transparent bg-transparent transition-all duration-300"
>
  <div class="container-page flex h-16 items-center justify-between gap-4 md:h-20">
    <a href="/" class="focus-ring inline-flex items-center gap-2 rounded-full px-2 py-1">
      <span class="h-2 w-2 rounded-full bg-accent"></span>
      <span class="font-display text-lg tracking-tight">Sculpted Light</span>
    </a>

    <nav aria-label="Hlavní navigace" class="hidden items-center gap-1 md:flex">
      {nav.map((item) => (
        <a
          href={item.href}
          class="focus-ring rounded-full px-3 py-2 text-sm font-medium text-text-muted transition hover:bg-highlight hover:text-text"
        >
          {item.label}
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-2">
      <details class="mobile-nav relative md:hidden">
        <summary
          class="focus-ring inline-flex min-h-[44px] min-w-[44px] cursor-pointer items-center justify-center rounded-full border hairline bg-surface px-3 text-text list-none"
          aria-label="Otevřít navigaci"
        >
          <span aria-hidden="true">≡</span>
        </summary>
        <nav
          aria-label="Mobilní navigace"
          class="absolute right-0 top-[calc(100%+10px)] z-50 min-w-[220px] rounded-lg border hairline bg-surface p-3 shadow-card"
        >
          <ul class="space-y-1">
            {nav.map((item) => (
              <li>
                <a
                  href={item.href}
                  class="focus-ring block rounded-md px-3 py-2 text-sm font-medium text-text-muted transition hover:bg-highlight hover:text-text"
                >
                  {item.label}
                </a>
              </li>
            ))}
            <li class="pt-1">
              <ButtonLink href="#contact" label="Konzultace" class="w-full justify-center" />
            </li>
          </ul>
        </nav>
      </details>
      <ButtonLink href="#contact" label="Konzultace" class="hidden md:inline-flex" />
    </div>
  </div>
</header>

<script is:inline>
  (() => {
    const header = document.querySelector("[data-site-header]");
    if (!header || header.dataset.bound === "true") return;
    header.dataset.bound = "true";

    const scrolledClasses = [
      "bg-bg/80",
      "hairline",
      "backdrop-blur",
      "supports-[backdrop-filter]:bg-bg/70",
      "shadow-soft",
    ];

    const update = () => {
      const isScrolled = window.scrollY > 40;
      header.dataset.scrolled = isScrolled ? "true" : "false";
      scrolledClasses.forEach((className) => header.classList.toggle(className, isScrolled));
    };

    update();
    window.addEventListener("scroll", update, { passive: true });
  })();
</script>

<style>
  .mobile-nav summary::-webkit-details-marker {
    display: none;
  }
</style>
